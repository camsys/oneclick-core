=content_for :header do
  Service Area

=simple_form_for @service,
  url: admin_service_path, remote: true, authenticity_token: true, data: {type: 'html'},
  html: {class: 'form-horizontal', id: form_id_from_path, multipart: true, method: :put } do |f|
  =remote_form_input # This sends the partial_path to the controller, so it can serve back the correct partial

  .form-group.string.optional.trip-within-area
    %label.col-sm-6.control-label.text.optional{for: 'paratransit_trip_within_area'} All trips must start AND end within this area:
    .col-sm-4
      .input-group.col-sm-12
        %input#trip-within-area-input.form-control.string.optional{type: 'text'}
      #trip-within-area-results.dropdown{style: 'position:absolute; z-index:499'}
  .well#trip-within-area-display
  =f.simple_fields_for :trip_within_area do |r|
    =r.input :recipe,
      wrapper_html: {class: 'hidden'},
      input_html: { value: @service.trip_within_area.recipe.to_json }

  = map(center: { latlng: [42, -71], zoom: 5 })

:javascript
  $(document).ready(function() {

    var fh = new FormHandler($('#{form_selector_from_id}'));

    M.drawMaps([
      #{@service.trip_within_area && @service.trip_within_area.geom_to_array}
    ]);

    var tripWithinAreaRecipe = new M.Recipe({
      fieldName: 'trip-within-area',
      recipeForm: 'taxi_trip_within_area_attributes_recipe',
      searchPath: '#{admin_service_path}',
      ingredientLabelTag: '#{escape_javascript render partial: "admin/services/ingredient_label"}'
    });

    fh.onReset(function() {
      tripWithinAreaRecipe.reset();
    });

  });
