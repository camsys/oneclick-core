# Script to transfer initial Travel Patterns data from QA to Production.
#
# Export data:
# agency_name = "rabbittransit"
# agency = Agency.find_by(name: agency_name)
# service_schedules = ServiceSchedule.where(agency_id: agency.id).order(:name)
# service_schedules.map{|x| x.attributes.except("agency_id", "created_at", "updated_at").
#   merge({ service_sub_schedules: x.service_sub_schedules.map{|y| y.attributes.except("id", "agency_id", "created_at", "updated_at")}})}
# After export:
# Quote calendar_date
# Replace :service_sub_schedules with "service_sub_schedules"
[
  {"id"=>42, "service_schedule_type_id"=>1, "name"=>"Adams County Weekday Service Schedule", "description"=>"Adams County Weekday Service Schedule","start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>42, "day"=>1, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>42, "day"=>2, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>42, "day"=>3, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>42, "day"=>4, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>42, "day"=>5, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}]}, {"id"=>43, "service_schedule_type_id"=>1, "name"=>"CHD ADA Weekday Service Schedule", "description"=>"CHD ADA Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>43, "day"=>1, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>43, "day"=>2, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>43, "day"=>3, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>43, "day"=>4, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>43, "day"=>5, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}]}, {"id"=>53, "service_schedule_type_id"=>1, "name"=>"Columbia County Weekday Service Schedule", "description"=>"Columbia County Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>53, "day"=>2, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>53, "day"=>3, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>53, "day"=>4, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>53, "day"=>1, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>53, "day"=>5, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}]}, {"id"=>40, "service_schedule_type_id"=>1, "name"=>"Cumberland County Weekday Service Schedule", "description"=>"Cumberland County Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>40, "day"=>1, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>40, "day"=>2, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>40, "day"=>3, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>40, "day"=>4, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>40, "day"=>5, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}]}, {"id"=>41, "service_schedule_type_id"=>1, "name"=>"Dauphin County Weekday Service Schedule", "description"=>"Dauphin County Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>41, "day"=>1, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>41, "day"=>2, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>41, "day"=>3, "start_time"=>28800,"end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>41, "day"=>4, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}, {"service_schedule_id"=>41, "day"=>5, "start_time"=>28800, "end_time"=>63000, "calendar_date"=>nil}]}, {"id"=>39, "service_schedule_type_id"=>1, "name"=>"Franklin County Weekday Service Schedule", "description"=>"Franklin County Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>39, "day"=>1, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>39, "day"=>2, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>39, "day"=>3, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>39, "day"=>4, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>39, "day"=>5, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}]}, {"id"=>55, "service_schedule_type_id"=>1, "name"=>"Montour County Weekday Service Schedule", "description"=>"Montour County Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>55, "day"=>1, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>55, "day"=>2, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>55, "day"=>3, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>55, "day"=>4,"start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>55, "day"=>5, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}]}, {"id"=>54, "service_schedule_type_id"=>1, "name"=>"Northumberland County Weekday Service Schedule", "description"=>"Northumberland CountyWeekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>54, "day"=>1, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>54, "day"=>2, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>54, "day"=>3, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>54, "day"=>4, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>54, "day"=>5, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}]}, {"id"=>38, "service_schedule_type_id"=>1, "name"=>"Perry County Weekday Service Schedule", "description"=>"Perry County Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>38, "day"=>1, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>38, "day"=>2, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>38, "day"=>3, "start_time"=>32400,"end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>38, "day"=>4, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>38, "day"=>5, "start_time"=>32400, "end_time"=>57600, "calendar_date"=>nil}]}, {"id"=>37, "service_schedule_type_id"=>2, "name"=>"rabbittransit Holiday Schedule", "description"=>"rabbittransit Holiday Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 24 Nov 2022"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Sun, 25 Dec 2022"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Sun, 01 Jan 2023"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 29 May 2023"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Tue, 04 Jul 2023"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 23 Nov 2023"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 25 Dec 2023"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 01 Jan 2024"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 27 May 2024"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 04 Jul 2024"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 02 Sep 2024"},{"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 28 Nov 2024"}, {"service_schedule_id"=>37, "day"=>nil,"start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Wed, 25 Dec 2024"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Wed, 01 Jan 2025"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 26 May 2025"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Fri, 04 Jul 2025"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 01 Sep 2025"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 27 Nov 2025"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 25 Dec 2025"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 01 Jan 2026"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 25 May 2026"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Sat, 04 Jul 2026"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 07 Sep 2026"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 26 Nov 2026"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Fri, 25 Dec 2026"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Fri, 01 Jan 2027"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 31 May 2027"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Sun, 04 Jul 2027"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Mon, 06 Sep 2027"}, {"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Thu, 25 Nov 2027"},{"service_schedule_id"=>37, "day"=>nil, "start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Sat, 25 Dec 2027"}, {"service_schedule_id"=>37, "day"=>nil,"start_time"=>nil, "end_time"=>nil, "calendar_date"=>"Wed, 16 Nov 2022"}]}, {"id"=>112, "service_schedule_type_id"=>1, "name"=>"testing1118", "description"=>"testing", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>112, "day"=>1, "start_time"=>21600, "end_time"=>72000, "calendar_date"=>nil}, {"service_schedule_id"=>112, "day"=>3, "start_time"=>21600, "end_time"=>72000, "calendar_date"=>nil}, {"service_schedule_id"=>112, "day"=>3, "start_time"=>18000, "end_time"=>72000, "calendar_date"=>nil}, {"service_schedule_id"=>112, "day"=>4, "start_time"=>21600, "end_time"=>72000, "calendar_date"=>nil}, {"service_schedule_id"=>112, "day"=>4, "start_time"=>21600, "end_time"=>72000, "calendar_date"=>nil}, {"service_schedule_id"=>112, "day"=>6, "start_time"=>21600, "end_time"=>72000, "calendar_date"=>nil}, {"service_schedule_id"=>112, "day"=>5, "start_time"=>21600, "end_time"=>25200, "calendar_date"=>nil}, {"service_schedule_id"=>112, "day"=>5, "start_time"=>37800, "end_time"=>79200, "calendar_date"=>nil}]}, {"id"=>56, "service_schedule_type_id"=>1, "name"=>"Union and Snyder Counties Weekday Service Schedule", "description"=>"Union and Snyder Counties Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>56, "day"=>1, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>56, "day"=>2, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>56, "day"=>3, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>56, "day"=>4, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}, {"service_schedule_id"=>56, "day"=>5, "start_time"=>28800, "end_time"=>57600, "calendar_date"=>nil}]}, {"id"=>44, "service_schedule_type_id"=>1, "name"=>"York-Adams ADA Weekday Service Schedule", "description"=>"York-Adams ADA Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>44, "day"=>1, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>44, "day"=>2, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>44, "day"=>3, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>44, "day"=>4, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>44, "day"=>5, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}]}, {"id"=>36, "service_schedule_type_id"=>1, "name"=>"York County Weekday ServiceSchedule", "description"=>"York County Weekday Service Schedule", "start_date"=>nil, "end_date"=>nil, "service_sub_schedules"=>[{"service_schedule_id"=>36, "day"=>1, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>36, "day"=>2, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>36, "day"=>3, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>36, "day"=>4, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}, {"service_schedule_id"=>36, "day"=>5, "start_time"=>28800, "end_time"=>61200, "calendar_date"=>nil}]}
].each do | config_data|
  agency_name = "rabbittransit"
  agency = Agency.find_by(name: agency_name)
  config = ServiceSchedule.find_by(name: config_data["name"], agency_id: agency.id)
  if config
    Rails.logger.info "Updating #{config_data["name"]}"
    config.update_attributes(config_data.except("service_sub_schedules"))
    config.service_sub_schedules = []
    config_data["service_sub_schedules"].each do |config_sub_schedule|
      Rails.logger.info "Creating #{config_sub_schedule["calendar_date"]} #{config_sub_schedule["start_time"]} #{config_sub_schedule["end_time"]}"
      sub_schedule = ServiceSubSchedule.new
      sub_schedule.service_schedule = config
      sub_schedule.day = config_sub_schedule["day"]
      sub_schedule.start_time = config_sub_schedule["start_time"]
      sub_schedule.end_time = config_sub_schedule["end_time"]
      sub_schedule.calendar_date = config_sub_schedule["calendar_date"]
      sub_schedule.save!
    end
  else
    begin
      Rails.logger.info "Creating #{config_data["name"]}"
      service_schedule = ServiceSchedule.create!(
        :name => config_data["name"],
        :description => config_data["description"],
        :service_schedule_type_id => config_data["service_schedule_type_id"],
        :start_date => config_data["start_date"],
        :end_date => config_data["end_date"],
        :agency_id => agency.id,
        )
      service_schedule.service_sub_schedules = []
      config_data["service_sub_schedules"].each do |config_sub_schedule|
        Rails.logger.info "Creating #{config_sub_schedule["calendar_date"]} #{config_sub_schedule["start_time"]} #{config_sub_schedule["end_time"]}"
        sub_schedule = ServiceSubSchedule.new
        sub_schedule.service_schedule = service_schedule
        sub_schedule.day = config_sub_schedule["day"]
        sub_schedule.start_time = config_sub_schedule["start_time"]
        sub_schedule.end_time = config_sub_schedule["end_time"]
        sub_schedule.calendar_date = config_sub_schedule["calendar_date"]
        sub_schedule.save!
      end
    rescue => e
      Rails.logger.warn e.message
    end
  end
end
